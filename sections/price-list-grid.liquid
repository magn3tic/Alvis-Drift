<!-- PRINT STYLES -->
<link rel="stylesheet" href="{{ 'component-rte.css' | asset_url }}" media="print" onload="this.media='all'">
<link rel="stylesheet" href="{{ 'section-main-page.css' | asset_url }}" media="print" onload="this.media='all'">
<noscript>{{ 'component-rte.css' | asset_url | stylesheet_tag }}</noscript>
<noscript>{{ 'section-main-page.css' | asset_url | stylesheet_tag }}</noscript>

<div class="page-width page-width--narrow">
  <h2 class="page-title">ALVIâ€™S DRIFT PRICE OVERVIEW</h2>

  <div class="Product-default-sort">
    <select name="sort_by" id="sort-by" aria-describedby="a11y-refresh-page-message" class="collection-sort__input sort-by">
      {% for option in collection.sort_options %}
        <option value="{{ option.value }}"{% if sort_by == option.value %} selected="selected"{% endif %}>{{ option.name }}</option>
      {% endfor %}
    </select>
  </div>

  <div id="ProductGridContainer_notcollection">
    {%- paginate collection.products by 100 -%}
    {%- if collection.products.size == 0 -%}
      <div class="collection collection--empty page-width" id="product-grid" data-id="{{ section.id }}">
        <div class="title-wrapper center">
          <h2 class="title title--primary">
            {{ 'sections.collection_template.empty' | t }}<br>
            {{ 'sections.collection_template.use_fewer_filters_html' | t: link: collection.url, class: "underlined-link link" }}
          </h2>
        </div>
      </div>
    {%- else -%}
      <div class="container-price-list wrap">
        {%- for product in collection.products -%}
          <div class="price-list box">
            <div class="product-image">
              <a target="_blank" href="{{ product.url }}">
                <img src="{{ product.featured_image | img_url: 'master' }}" alt="" loading="lazy">
              </a>
            </div>
            <div class="product-name">
              <a target="_blank" href="{{ product.url }}"><h3>{{ product.title }}</h3></a>
            </div>
            <div class="product-price">
              <a target="_blank" href="{{ product.url }}">
                <h3>{{ product.price | money | remove: '.00' | replace: ',', ' ' }}</h3>
              </a>
            </div>
          </div>
        {%- endfor -%}
        {%- if paginate.pages > 1 -%}
          {% render 'pagination', paginate: paginate, anchor: '' %}
        {%- endif -%}
      </div>
    {%- endif -%}
    {%- endpaginate -%}
  </div>

  <!-- Hidden print version -->
  <div id="DivIdToPrint" style="display:none;">
    <table class="price-table-list" style="width:100%; border:0;">
      {%- for product in collection.products -%}
        <tr style="margin-bottom:35px;">
          <td><img style="height:100px;" src="{{ product.featured_image | img_url:'master' }}"></td>
          <td><h3>{{ product.title }}</h3></td>
          <td><h2>{{ product.price | money | remove:'.00' }}</h2></td>
        </tr>
      {% endfor %}
    </table>
  </div>

  <!-- PRINT BUTTON -->
  <div class="product-print-btn">
    <button id="btn" onclick="printDiv()">Print This Page</button>
  </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function () {
  const select = document.getElementById('sort-by');
  if (!select) return;

  // Preselect from query string if present
  const params = new URLSearchParams(window.location.search);
  const qsSort = params.get('sort_by');
  if (qsSort && [...select.options].some(o => o.value === qsSort)) {
    select.value = qsSort;
  }

  // Change handler: update URL while preserving other params
  select.addEventListener('change', function (e) {
    const value = e.target.value;
    const next = new URLSearchParams(window.location.search);
    next.set('sort_by', value);

    // Reset pagination if user changes sort
    next.delete('page');

    const query = next.toString();
    const url = window.location.pathname + (query ? '?' + query : '');
    window.location.assign(url);
  });
});
</script>

<!-- STYLES -->
<style>
.price-list {
  display:flex;
  justify-content:space-evenly;
  align-items:center;
  margin-bottom:20px;
}
.product-image img { height:250px;width:auto }
.product-image { width:12%; }
.product-name { width:63%; padding-left:30px; }
.product-price { width:11%; text-align:right; }
.product-print-btn { text-align:center; margin-bottom:50px; }
.page-width--narrow { max-width:100rem !important; padding:0; }
.Product-default-sort { text-align:left; padding:50px 5px; }
select#sort-by, button#btn {
  cursor:pointer;
  color:var(--headingColor);
  font:bold 14px/100% var(--metropolis);
  letter-spacing:.7px;
  text-transform:uppercase;
  background:transparent;
  border:1px solid var(--headingColor);
  padding:11px 32px;
}
select#sort-by option { background:#210e21 !important; }

@media only screen and (max-width:850px){
  .price-list .product-name{ width:50%; }
  .product-price{ width:auto; text-align:center; }
  select#sort-by{ margin-left:275px; }
}
@media only screen and (max-width:500px){
  .price-list{ margin:20px; font-size:10px; flex-direction:column; align-items:flex-start; }
  .product-image, .product-name, .product-price{ width:auto; text-align:left; }
  .Product-default-sort{ text-align:center; padding:50px 5px; }
  select#sort-by{ margin-left:0; }
}
body{ background-color:#480115; }
</style>

<!-- FIXED SCRIPT -->
<script>
function printDiv() {
  const divToPrint = document.getElementById('DivIdToPrint');
  const newWin = window.open('', 'Print-Window', 'width=800,height=600');
  newWin.document.write('<!doctype html><html><head><title>Print</title>');
  newWin.document.write('<style>body{font-family:Arial,sans-serif;}</style>');
  newWin.document.write('</head><body>');
  newWin.document.write(divToPrint.innerHTML);
  newWin.document.write('</body></html>');
  newWin.document.close();
  newWin.focus();
  newWin.print();
  newWin.close();
}
</script>
